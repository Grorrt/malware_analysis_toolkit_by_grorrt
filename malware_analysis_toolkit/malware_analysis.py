# (Main module)

from file_analysis import AnalyzeFile, ExtractStrings, GetPeInfo, DetectPacking, AnalyzeImports
from reporting import GenerateReport, VisualizeReport
from config import VIRUSTOTAL_API_KEY

def AnalyzeMalware(filePath):
    """
    Analyze a malware sample and generate a report.
    :param file_path: Path to the malware sample.
    :return: Analysis report.
    """
    hashes, vtResult = AnalyzeFile(filePath, VIRUSTOTAL_API_KEY)
    strings = ExtractStrings(filePath)
    peInfo = GetPeInfo(filePath)
    packed = DetectPacking(peInfo)
    suspiciousImports = AnalyzeImports(peInfo['imports'])
    report = GenerateReport(filePath, hashes, vtResult, peInfo, strings, packed, suspiciousImports)
    return report

if __name__ == "__main__":
    import sys
    if len(sys.argv) != 2:
        print("Usage: python malware_analysis.py <path_to_malware_sample>")
        sys.exit(1)

    filePath = sys.argv[1]
    report = AnalyzeMalware(filePath)
    #print(report)
    VisualizeReport(report)